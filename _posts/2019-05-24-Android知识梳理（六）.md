---
layout:     post
title:      "Android知识梳理（六）"
subtitle:   ""
date:       2019-05-24 09:54:00
author:     "Joker"
header-img: "img/post-think-try-write.jpg"
tags:
- Android
---

### 101、你一般在开发项目中都使用什么设计模式？如何来重构，优化你的代码？

较为常用的就是单例设计模式，工厂设计模式以及观察者设计模式,

一般需要保证对象在内存中的唯一性时就是用单例模式,例如对数据库操作的 SqliteOpenHelper 的对象。

工厂模式主要是为创建对象提供过渡接口，以便将创建对象的具体过程屏蔽隔离起来，达到提高灵活性的目的。

观察者模式定义对象间的一种一对多的依赖关系，当一个对象的状态发生改变时，所有依赖于它的对象都得到通知并被自动更新




### 102、Android 应用中验证码登陆都有哪些实现方案

从服务器端获取图片

通过短信服务，将验证码发送给客户端复制代码



### 103、定位项目中，如何选取定位方案，如何平衡耗电与实时位置的精度？

开始定位，Application 持有一个全局的公共位置对象，然后隔一定时间自动刷新位置，每次刷新成功都把新的位置信息赋值到全局的位置对象， 然后每个需要使用位置请求的地方都使用全局的位置信息进行请求。

该方案好处：请求的时候无需再反复定位，每次请求都使用全局的位置对象，节省时间。

该方案弊端：耗电，每隔一定时间自动刷新位置，对电量的消耗比较大。复制代码

按需定位，每次请求前都进行定位。这样做的好处是比较省电，而且节省资源，但是请求时间会变得相对较长。



### 104、andorid 应用第二次登录实现自动登录

前置条件是所有用户相关接口都走 https，非用户相关列表类数据走 http。

步骤

第一次登陆 getUserInfo 里带有一个长效 token，该长效 token 用来判断用户是否登陆和换取短 token

把长效 token 保存到 SharedPreferences

接口请求用长效 token 换取短token，短 token 服务端可以根据你的接口最后一次请求作为标示，超时时间为一天。

所有接口都用短效 token

如果返回短效 token 失效，执行第3步，再直接当前接口

如果长效 token 失效（用户换设备或超过一月），提示用户登录。



### 105、说说 LruCache 底层原理

LruCache 使用一个 LinkedHashMap 简单的实现内存的缓存，没有软引用，都是强引用。如果添加的数据大于设置的最大值，就删除最先缓存的数据来调整内存。maxSize 是通过构造方法初始化的值，他表示这个缓存能缓存的最大值是多少。size 在添加和移除缓存都被更新值， 他通过 safeSizeOf 这个方法更新值。 safeSizeOf 默认返回 1，但一般我们会根据 maxSize 重写这个方法，比如认为 maxSize 代表是 KB 的话，那么就以 KB 为单位返回该项所占的内存大小。除异常外，首先会判断 size 是否超过 maxSize，如果超过了就取出最先插入的缓存，如果不为空就删掉，并把 size 减去该项所占的大小。这个操作将一直循环下去，直到 size 比 maxSize 小或者缓存为空。




### 106、jni 的调用过程?

安装和下载 Cygwin，下载 Android NDK。

ndk 项目中 JNI 接口的设计。

使用 C/C++实现本地方法。

JNI 生成动态链接库.so 文件。

将动态链接库复制到 java 工程，在 java 工程中调用，运行 java 工程即可。



### 107、一条最长的短信息约占多少byte?

中文70(包括标点)，英文160，160个字节。



### 108、即时通讯是是怎么做的?

使用asmark 开源框架实现的即时通讯功能.该框架基于开源的 XMPP 即时通信协议，采用 C／S 体系结构，通过 GPRS 无线网络用 TCP 协议连接到服务器，以架设开源的Openfn'e 服务器作为即时通讯平台。客户端基于 Android 平台进行开发。负责初始化通信过程，进行即时通信时，由客户端负责向服务器发起创建连接请求。系统通过 GPRS 无线网络与 Internet 网络建立连接，通过服务器实现与Android 客户端的即时通信脚。服务器端则采用 Openfire 作为服务器。 允许多个客户端同时登录并且并发的连接到一个服务器上。服务器对每个客户端的连接进行认证，对认证通过的客户端创建会话，客户端与服务器端之间的通信就在该会话的上下文中进行。



### 109、怎样对 android 进行优化？

对 listview 的优化。

对图片的优化。

对内存的优化。

具体一些措施

尽量不要使用过多的静态类static

数据库使用完成后要记得关闭 cursor

广播使用完之后要注销复制代码





### 110、如果有个100M大的文件，需要上传至服务器中，而服务器form表单最大只能上传2M，可以用什么方法。

首先来说使用http协议上传数据，特别在android下，跟form没什么关系。传统的在web中，在form中写文件上传，其实浏览器所做的就是将我们的数据进行解析组拼成字符串，以流的方式发送到服务器，且上传文件用的都是POST方式，POST方式对大小没什么限制。回到题目，可以说假设每次真的只能上传2M，那么可能我们只能把文件截断，然后分别上传了，断点上传。





### 111、什么是嵌入式实时操作系统, Android 操作系统属于实时操作系统吗?

实时操作系统是指当外界事件或数据产生时，能够接受并以足够快的速度予以处理，其处理的结果又能在规定的时间之内来控制生产过程或对处理系统作出快速响应，并控制所有实时任务协调一致运行的嵌入式操作系统。主要用于工业控制、军事设备、航空航天等领域对系统的响应时间有苛刻的要求，这就需要使用实时系统。又可分为软实时和硬实时两种，而Android是基于Linux内核的，因此属于软实时。





### 112、对于Android 的安全问题？

①错误导出组件

② 参数校验不严

③WebView引入各种安全问题,webview中的js注入

④不混淆、不防二次打包

⑤明文存储关键信息

⑦ 错误使用HTTPS

⑧山寨加密方法

⑨滥用权限、内存泄露、使用debug签名



### 113、如何缩减APK包大小？

**代码**

①保持良好的编程习惯，不要重复或者不用的代码，谨慎添加libs，移除使用不到的libs。
②使用proguard混淆代码，它会对不用的代码做优化，并且混淆后也能够减少安装包的大小。
③Native Code的部分，大多数情况下只需要支持armabi与x86的架构即可。如果非必须，可以考虑拿掉x86的部分。



**资源**

①使用Lint工具查找没有使用到的资源。去除不使用的图片，String，XML等等。 assets目录下的资源请确保没有用不上的文件。

②生成APK的时候，aapt工具本身会对png做优化，但是在此之前还可以使用其他工具如tinypng对图片进行进一步的压缩预处理。

③Jpeg还是Png，根据需要做选择，在某些时候jpeg可以减少图片的体积。 对于9.png的图片，可拉伸区域尽量切小，另外可以通过使用9.png拉伸达到大图效果的时候尽量不要使用整张大图。


**策略**
①有选择性的提供hdpi，xhdpi，xxhdpi的图片资源。建议优先提供xhdpi的图片，对于mdpi，ldpi与xxxhdpi根据需要提供有差异的部分即可。

②尽可能的重用已有的图片资源。例如对称的图片，只需要提供一张，另外一张图片可以通过代码旋转的方式实现。

③能用代码绘制实现的功能，尽量不要使用大量的图片。例如减少使用多张图片组成animate-list的AnimationDrawable，这种方式提供了多张图片很占空间。



### 114、设备横竖屏切换的时候，接下来会发生什么？

①不设置Activity的android:configChanges时，切屏会重新调用各个生命周期，切横屏时会执行一次，切竖屏时会执行两次

②设置Activity的android:configChanges=”orientation”时，切屏还是会重新调用各个生命周期，切横、竖屏时只会执行一次

③设置Activity的android:configChanges=”orientation|keyboardHidden”时，切屏不会重新调用各个生命周期，只会执行onConfigurationChanged方法




### 115、谈谈你对binder机制的理解?

binder是一种IPC机制,进程间通讯的一种工具.

Java层可以利用aidl工具来实现相应的接口.



### 116、Android中touch事件的传递机制是怎样的?

1.Touch事件传递的相关API有dispatchTouchEvent、onTouchEvent、onInterceptTouchEvent
2.Touch事件相关的类有View、ViewGroup、Activity
3.Touch事件会被封装成MotionEvent对象，该对象封装了手势按下、移动、松开等动作
4.Touch事件通常从Activity#dispatchTouchEvent发出，只要没有被消费，会一直往下传递，到最底层的View
5.如果Touch事件传递到的每个View都不消费事件，那么Touch事件会反向向上传递,最终交由Activity#onTouchEvent处理
6.onInterceptTouchEvent为ViewGroup特有，可以拦截事件
7.Down事件到来时，如果一个View没有消费该事件，那么后续的MOVE/UP事件都不会再给它



### 117、Android开发中何时使用多进程？使用多进程的好处是什么？

要想知道如何使用多进程，先要知道Android里的多进程概念。一般情况下，一个应用程序就是一个进程，这个进程名称就是应用程序包名。我们知道进程是系统分配资源和调度的基本单位，所以每个进程都有自己独立的资源和内存空间，别的进程是不能任意访问其他进程的内存和资源的。



### 118、如何让自己的应用拥有多个进程？

很简单，我们的四大组件在AndroidManifest文件中注册的时候，有个属性是android:process，1.这里可以指定组件的所处的进程。默认就是应用的主进程。指定为别的进程之后，系统在启动这个组件的时候，就先创建（如果还没创建的话）这个进程，然后再创建该组件。你可以重载Application类的onCreate方法，打印出它的进程名称，就可以清楚的看见了。再设置android:process属性时候，有个地方需要注意：如果是android:process=”:deamon”，以:开头的名字，则表示这是一个应用程序的私有进程，否则它是一个全局进程。私有进程的进程名称是会在冒号前自动加上包名，而全局进程则不会。一般我们都是有私有进程，很少使用全局进程。



### 119、多线程的优劣

使用多进程显而易见的好处就是分担主进程的内存压力。我们的应用越做越大，内存越来越多，将一些独立的组件放到不同的进程，它就不占用主进程的内存空间了。当然还有其他好处，有心人会发现Android后台进程里有很多应用是多个进程的，因为它们要常驻后台，特别是即时通讯或者社交应用，不过现在多进程已经被用烂了。典型用法是在启动一个不可见的轻量级私有进程，在后台收发消息，或者做一些耗时的事情，或者开机启动这个进程，然后做监听等。还有就是防止主进程被杀守护进程，守护进程和主进程之间相互监视，有一方被杀就重新启动它。

坏处的话，多占用了系统的空间，大家都这么用的话系统内存很容易占满而导致卡顿。消耗用户的电量。应用程序架构会变复杂，应为要处理多进程之间的通信。这里又是另外一个问题了。





### 120、ANR是什么？怎样避免和解决ANR?

ANR:Application Not Responding，即应用无响应

ANR一般有三种类型：

1：KeyDispatchTimeout(5 seconds) –主要类型

按键或触摸事件在特定时间内无响应

2：BroadcastTimeout(10 seconds)

BroadcastReceiver在特定时间内无法处理完成

3：ServiceTimeout(20 seconds) –小概率类型



Service在特定的时间内无法处理完成超时的原因一般有两种：

(1)当前的事件没有机会得到处理（UI线程正在处理前一个事件没有及时完成或者looper被某种原因阻塞住）

(2)当前的事件正在处理，但没有及时完成



UI线程尽量只做跟UI相关的工作，耗时的工作（数据库操作，I/O，连接网络或者其他可能阻碍UI线程的操作）放入单独的线程处理，尽量用Handler来处理UI thread和thread之间的交互。

UI线程主要包括如下：

1.Activity:onCreate(), onResume(), onDestroy(), onKeyDown(), onClick()

2.AsyncTask: onPreExecute(), onProgressUpdate(), onPostExecute(), onCancel()

3.Mainthread handler: handleMessage(), post(runnable r)



### 121、Android下解决滑动冲突的常见思路是什么?

相关的滑动组件 重写onInterceptTouchEvent，然后判断根据xy值，来决定是否要拦截当前操作



### 122、如何把一个应用设置为系统应用？

成为系统应用，首先要在 对应设备的 Android 源码 SDK 下编译，编译好之后：此 Android 设备是 Debug 版本，并且已经 root，直接将此 apk 用 adb 工具 push 到 system/app 或 system/priv-app 下即可。如果非 root 设备，需要编译后重新烧写设备镜像即可。有些权限(如 WRITE_SECURE_SETTINGS )，是不开放给第三方应用的，只能在对应设备源码中编译然后作为系统 app 使用。



### 123、Android内存泄露研究

Android内存泄漏指的是进程中某些对象（垃圾对象）已经没有使用价值了，但是它们却可以直接或间接地引用到gc roots导致无法被GC回收。无用的对象占据着内存空间，使得实际可使用内存变小，形象地说法就是内存泄漏了。

场景

①类的静态变量持有大数据对象

②静态变量长期维持到大数据对象的引用，阻止垃圾回收。

③非静态内部类的静态实例

④非静态内部类会维持一个到外部类实例的引用，如果非静态内部类的实例是静态的，就会间接长期维持着外部类的引用，阻止被回收掉。。

⑤资源对象未关闭

⑥资源性对象如Cursor、File、Socket，应该在使用后及时关闭。未在finally中关闭，会导致异常情况下资源对象未被释放的隐患。

⑦注册对象未反注册

⑧未反注册会导致观察者列表里维持着对象的引用，阻止垃圾回收。

⑨Handler临时性内存泄露

⑩Handler通过发送Message与主线程交互，Message发出之后是存储在MessageQueue中的，有些Message也不是马上就被处理的。在Message中存在一个 target，是Handler的一个引用，如果Message在Queue中存在的时间越长，就会导致Handler无法被回收。如果Handler是非静态的，则会导致Activity或者Service不会被回收。

⑾由于AsyncTask内部也是Handler机制，同样存在内存泄漏的风险。此种内存泄露，一般是临时性的。




### 124、内存泄露检测有什么好方法？

**检测**

1、DDMS Heap发现内存泄露

dataObject totalSize的大小，是否稳定在一个范围内，如果操作程序，不断增加，说明内存泄露

2、使用Heap Tool进行内存快照前后对比

BlankActivity手动触发GC进行前后对比，对象是否被及时回收

**定位**

1、MAT插件打开.hprof具体定位内存泄露：

查看histogram项，选中某一个对象，查看它的GC引用链，因为存在GC引用链的，说明无法回收

2、AndroidStudio的Allocation Tracker：

观测到期间的内存分配，哪些对象被创建，什么时候创建，从而准确定位



### 125、多进程应该能为我们带来什么呢

Android平台对应用都有内存限制，其实这个理解有点问题，应该是说android平台对每个进程有内存限制，比如某机型对对进程限制是24m，如果应用有两个进程，则该应该的总内存限制是2*24m。使用多进程就可以使得我们一个apk所使用的内存限制加大几倍。所以可以借此图片平台对应用的内存限制，比如一些要对图片、视频、大文件进程处理的好内存的应用可以考虑用多进程来解决应用操作不流畅问题。


链接：https://www.jianshu.com/p/1e10da330aaa
来源：简书
简书著作权归作者所有，任何形式的转载都请联系作者获得授权并注明出处。









来源：简书  
简书著作权归作者所有，任何形式的转载都请联系作者获得授权并注明出处。
